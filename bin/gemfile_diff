#!/usr/bin/env ruby

require_relative '../lib/whiskers'

if ARGV.length != 2
  puts "Usage: gemfile_diff GEMFILE_LOCK1 GEMFILE_LOCK2"
  exit 1
end

old_lockfile, new_lockfile = ARGV

begin
  diff = Whiskers::GemfileLockDiff.new(old_lockfile, new_lockfile)

  if diff.new_dependencies.any?
    puts "\nAdded gems:"
    diff.new_dependencies.sort_by(&:name).each do |dep|
      puts "  + #{dep.name} (#{dep.version})"
    end
  end

  if diff.changed_dependencies.any?
    puts "\nChanged versions:"
    diff.changed_dependencies.sort_by { |c| c.from.name }.each do |change|
      puts "  ~ #{change.from.name}: #{change.from.version} â†’ #{change.to.version}"
    end
  end

  if diff.new_dependencies.empty? && diff.changed_dependencies.empty?
    puts "No differences found between Gemfile.lock files"
  end
rescue ArgumentError => e
  puts "Error: #{e.message}"
  exit 1
end 
